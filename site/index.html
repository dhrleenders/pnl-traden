<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PnL Traden</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111827">
  <style>
    :root{--bg:#0b1220;--card:#0f1a2e;--muted:#9aa4b2;--text:#e5e7eb;--accent:#22c55e;--danger:#ef4444;--border:#1f2a44}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#070b14, var(--bg));color:var(--text)}
    header{position:sticky;top:0;background:rgba(7,11,20,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:5}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 14px 24px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    h1{font-size:18px;margin:0;letter-spacing:.2px}
    .pill{border:1px solid var(--border);background:rgba(255,255,255,.04);border-radius:999px;padding:8px 10px;display:flex;gap:8px;align-items:center}
    .pill.active{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.12)}
    select,button,input{color:var(--text);background:transparent;border:1px solid var(--border);border-radius:10px;padding:9px 10px}
    button{cursor:pointer}
    button.primary{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.35)}
    button.ghost{background:rgba(255,255,255,.03)}
    input[type="file"]{padding:8px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);cursor:pointer}
    .tab.active{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.12)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:14px}
    .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.03));border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 8px 22px rgba(0,0,0,.25)}
    .kpi{display:flex;flex-direction:column;gap:6px}
    .kpi .label{color:var(--muted);font-size:12px}
    .kpi .value{font-size:20px;font-weight:700}
    .kpi .sub{color:var(--muted);font-size:12px}
    .kpi.good .value{color:var(--accent)}
    .kpi.bad .value{color:var(--danger)}
    .kpi.warn .value{color:#fbbf24}
    .two{grid-column:span 12}
    @media (min-width:900px){
      .two{grid-column:span 6}
      .third{grid-column:span 4}
      .half{grid-column:span 6}
    }
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:10px 8px;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
    th{color:var(--muted);font-weight:600}
    tr:hover td{background:rgba(255,255,255,.02)}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .hint{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.4}
    .badge{padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);font-size:12px}
    .pos{color:var(--accent);font-variant-numeric:tabular-nums}
    .neg{color:var(--danger);font-variant-numeric:tabular-nums}
    .mono{font-variant-numeric:tabular-nums}
    .flex-between{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap}
    canvas{width:100%;height:260px}
    .danger{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.08)}
    .ok{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.08)}
    .small{font-size:12px}
  
    /* readability: dropdown text black */
    select, option { color: #000 !important; }
    select { background: #e5e7eb !important; }


    /* Calculator */
    .form{margin-top:10px;display:flex;flex-direction:column;gap:10px}
    .lbl{min-width:150px;color:var(--muted);font-size:12px}
    .in{flex:1;min-width:180px}
    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    @media(max-width:820px){.kpis{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <h1>PnL Traden</h1>
          <span class="badge" id="dbBadge">Lokaal</span>
          <span class="badge" id="fxBadge">FX: …</span>
        </div>
        <div class="row">
          <div class="pill">
            <span class="muted small">Valuta</span>
            <select id="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <button class="ghost" id="exportBtn">Export CSV</button>
          <button class="ghost" id="resetBtn">Reset data</button>
        </div>
      </div>
      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="dash">Dashboard</div>
        <div class="tab" data-tab="monthly">12 maanden</div>
        <div class="tab" data-tab="trades">Trades</div>
        <div class="tab" data-tab="calc">Calculator</div>
        <div class="tab" data-tab="import">Import</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Filters -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <div class="pill">
            <span class="muted small">Exchange</span>
            <select id="exchange">
              <option value="ALL">Alles</option>
              <option value="KRAKEN">Kraken</option>
              <option value="BLOFIN">BloFin</option>
            </select>
          </div>
          <div class="pill">
            <span class="muted small">Type</span>
            <select id="marketType">
              <option value="ALL">Alles</option>
              <option value="FUTURES">Futures</option>
              <option value="SPOT">Spot</option>
            </select>
          </div>
          <div class="pill">
            <span class="muted small">Periode</span>
            <select id="range">
              <option value="24h">24 uur</option>
              <option value="1w" selected>1 week</option>
              <option value="2w">2 weken</option>
              <option value="1m">1 maand</option>
              <option value="3m">Kwartaal</option>
              <option value="6m">Half jaar</option>
              <option value="1y">1 jaar</option>
              <option value="12m">Laatste 12 maanden</option>
              <option value="all">Totaal</option>
            </select>
          </div>
        </div>
        <div class="row">
          <span class="muted small" id="summaryLine">—</span>
        </div>
      </div>
      <div class="hint">
        Valuta = live EUR/USD (ECB-achtige feed via exchangerate.host). Data staat lokaal op je telefoon (IndexedDB).
      </div>
    </div>

    <!-- Dashboard -->
    <section id="view-dash" class="grid">
      <div class="card third">
        <div class="kpi" id="kpiNet">
          <div class="label">Net PnL</div>
          <div class="value">—</div>
          <div class="sub">PnL - fees + funding</div>
        </div>
      </div>
      <div class="card third">
        <div class="kpi" id="kpiFees">
          <div class="label">Fees</div>
          <div class="value">—</div>
          <div class="sub">totaal</div>
        </div>
      </div>
      <div class="card third">
        <div class="kpi" id="kpiWinrate">
          <div class="label">Winrate</div>
          <div class="value">—</div>
          <div class="sub">wins / trades</div>
        </div>
      </div>

      <div class="card two">
        <div class="flex-between">
          <div>
            <div style="font-weight:700">Cumulatieve PnL</div>
            <div class="muted small">Op basis van Net PnL per trade/order.</div>
          </div>
          <div class="row" style="gap:8px">
            <button class="pill active" id="btnChartZero" type="button">Nul-lijn</button>
            <button class="pill" id="btnChartArea" type="button">Voorbeeld</button>
            <span class="badge" id="countBadge">0 trades</span>
          </div>
        </div>
        <canvas id="equityCanvas" width="1000" height="320"></canvas>
    </section>

    <!-- Monthly -->
    <section id="view-monthly" class="grid" style="display:none">
      <div class="card two">
        <div class="flex-between">
          <div>
            <div style="font-weight:700">PnL per maand (rolling 12 maanden)</div>
            <div class="muted small">Net PnL, fees en funding (als aanwezig).</div>
          </div>
        </div>
        <canvas id="monthlyCanvas" width="1000" height="320"></canvas>
        <div class="hint" id="monthlyHint"></div>
    </section>

    <!-- Trades -->
    <section id="view-trades" class="grid" style="display:none">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="row">
            <input id="search" placeholder="Zoek: symbool, id, notes…" style="min-width:240px">
          </div>
          <div class="row">
            <span class="muted small" id="tradeCount">—</span>
          </div>
        </div>
        <div style="overflow:auto;margin-top:10px">
          <table>
            <thead>
              <tr>
                <th>Datum</th>
                <th>Exchange</th>
                <th>Symbool</th>
                <th>Type</th>
                <th>Side</th>
                <th class="right">Qty</th>
                <th class="right">Price</th>
                <th class="right">Fees</th>
                <th class="right">PnL</th>
                <th class="right">Net</th>
                <th>ID/Notes</th>
              </tr>
            </thead>
            <tbody id="tradeRows"></tbody>
          </table>
        </div>
        <div class="hint">Tip: BloFin order history bevat PNL en Fee per order. Kraken trades.csv in dit project was leeg; zodra je een echte export importeert, komt het hier ook binnen.</div>
    </section>

    
    <!-- Calculator -->
    <section id="view-calc" class="grid" style="display:none">
        <div class="card half">
          <div class="card-h">
            <div>
              <div class="title">Positie calculator</div>
              <div class="hint">Bereken size op basis van risico (stop-loss). Werkt voor long & short.</div>
            </div>
          </div>

          <div class="form">
            <div class="row">
              <label class="lbl">Richting</label>
              <select id="calcSide" class="in">
                <option value="LONG" selected>Long</option>
                <option value="SHORT">Short</option>
              </select>
            </div>

            <div class="row">
              <label class="lbl">Entry prijs</label>
              <input id="calcEntry" class="in mono" inputmode="decimal" placeholder="bijv. 42000" />
            </div>

            <div class="row">
              <label class="lbl">Stop prijs</label>
              <input id="calcStop" class="in mono" inputmode="decimal" placeholder="bijv. 41500" />
            </div>

            <div class="row">
              <label class="lbl">Take-profit (optioneel)</label>
              <input id="calcTP" class="in mono" inputmode="decimal" placeholder="bijv. 43500" />
            </div>

            <div class="row">
              <label class="lbl">Balance</label>
              <input id="calcBalance" class="in mono" inputmode="decimal" placeholder="bijv. 5000" />
            </div>

            <div class="row">
              <label class="lbl">Risk % van balance</label>
              <div style="display:flex;gap:8px;align-items:center;flex:1">
                <input id="calcRiskPct" class="in mono" inputmode="decimal" placeholder="bijv. 1" style="flex:1" />
                <span class="badge">%</span>
                <label class="badge" style="display:flex;gap:6px;align-items:center">
                  <input id="calcUsePct" type="checkbox" style="accent-color:#22c55e" />
                  gebruik %
                </label>
              </div>
            </div>

            <div class="row">
              <label class="lbl">Risico per trade</label>
              <div style="display:flex;gap:8px;align-items:center;flex:1">
                <input id="calcRisk" class="in mono" inputmode="decimal" placeholder="bijv. 50" style="flex:1" />
                <span class="badge" id="calcRiskCur">USD</span>
              </div>
            </div>

            <div class="row">
              <label class="lbl">Contract size</label>
              <input id="calcContractSize" class="in mono" inputmode="decimal" value="1" />
            </div>

            <div class="row">
              <label class="lbl">Leverage</label>
              <input id="calcLev" class="in mono" inputmode="decimal" value="1" />
            </div>

            <div class="row">
              <label class="lbl">Fee % (totaal)</label>
              <input id="calcFeePct" class="in mono" inputmode="decimal" value="0.08" />
            </div>

            <div class="row" style="gap:10px;flex-wrap:wrap">
              <button class="btn" id="calcResetBtn" type="button">Reset</button>
              <span class="hint" id="calcHint">Vul entry/stop + risico in.</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-h">
            <div>
              <div class="title">Resultaat</div>
              <div class="hint">Notional in USD (en omgerekend naar gekozen valuta in de header).</div>
            </div>
          </div>

          <div class="kpis">
            <div class="kpi" id="calcKpiQty">
              <div class="label">Positie size (qty)</div>
              <div class="value">—</div>
              <div class="sub">Aantal contracts/coins</div>
            </div>

            <div class="kpi" id="calcKpiNotional">
              <div class="label">Notional</div>
              <div class="value">—</div>
              <div class="sub">Entry × qty</div>
            </div>

            <div class="kpi" id="calcKpiMargin">
              <div class="label">Benodigde margin</div>
              <div class="value">—</div>
              <div class="sub">Notional / leverage</div>
            </div>

            <div class="kpi" id="calcKpiSL">
              <div class="label">Verlies op stop (incl. fees)</div>
              <div class="value">—</div>
              <div class="sub">Doel ≈ risico</div>
            </div>

            <div class="kpi" id="calcKpiTP">
              <div class="label">Winst op TP (incl. fees)</div>
              <div class="value">—</div>
              <div class="sub">RR: —</div>
            </div>
          </div>
        </div>
    </section>

<!-- Import -->
    <section id="view-import" class="grid" style="display:none">
      <div class="card half">
        <div style="font-weight:700;margin-bottom:8px">Import CSV</div>
        <div class="muted small">Upload je exports van BloFin en/of Kraken Pro. We herkennen het formaat automatisch.</div>
        <div style="margin-top:12px">
          <input type="file" id="fileInput" accept=".csv">
        </div>
        <div class="row" style="margin-top:12px">
          <button class="primary" id="importBtn">Importeer</button>
          <span class="muted small" id="importStatus">—</span>
        </div>
        <div class="hint">
          Herkend:
          <ul>
            <li><span class="mono">BloFin</span>: kolommen zoals “Underlying Asset”, “Order Time”, “PNL”, “Fee”.</li>
            <li><span class="mono">Kraken</span>: trades/ledgers export (we mappen zoveel mogelijk standaard velden).</li>
          </ul>
        </div>
      </div>

      <div class="card half">
        <div style="font-weight:700;margin-bottom:8px">Snelle start (jouw meegeleverde bestanden)</div>
        <div class="muted small">Je kunt hieronder met 1 klik de voorbeeld-bestanden (die je net uploadde) inladen — handig om meteen te zien dat alles werkt.</div>
        <div class="row" style="margin-top:12px">
          <button class="ghost" id="loadSamplesBtn">Laad samples</button>
          <span class="muted small" id="sampleStatus">—</span>
        </div>
        <div class="hint">Let op: dit werkt alleen in de desktop/localhost versie die ik voor je heb klaargezet (de sample CSV’s zitten in de map).</div>
    </section>
  </main>

  <!-- Dexie (IndexedDB) -->
  <script src="https://unpkg.com/dexie@4/dist/dexie.min.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>
